<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="foncen">
<link rel="icon" type="image/png" href="../images/canal/favicon.png">
<title>优化商品分类树形接口,研究商品搜索</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book" toc2 toc-left">
<div id="header">
<h1>优化商品分类树形接口,研究商品搜索</h1>
<div class="details">
<span id="author" class="author">foncen</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">优化商品分类树形接口,研究商品搜索</div>
<ul class="sectlevel1">
<li><a href="#canal1-优化商品树形接口">1. 优化商品树形接口</a>
<ul class="sectlevel2">
<li><a href="#canal1-1-解决方案">1.1 解决方案</a></li>
<li><a href="#canal1-2-测试结果">1.2 测试结果</a></li>
</ul>
</li>
<li><a href="#canal2-研究商品搜索">2. 研究商品搜索</a>
<ul class="sectlevel2">
<li><a href="#canal2-1-方案选择">2.1 方案选择</a>
<ul class="sectlevel3">
<li><a href="#canal2-1-1-插件优缺点对比">2.1.1 插件优缺点对比</a></li>
</ul>
</li>
<li><a href="#canal2-2-canal-介绍">2.2 canal 介绍</a>
<ul class="sectlevel3">
<li><a href="#canal2-2-1-canal-简介">2.2.1 canal 简介</a></li>
<li><a href="#canal2-2-2-工作原理">2.2.2 工作原理</a></li>
</ul>
</li>
<li><a href="#canal2-3-单机部署-canal-1-1-5">2.3 单机部署 canal-1.1.5</a>
<ul class="sectlevel3">
<li><a href="#canal2-3-1-环境准备">2.3.1 环境准备</a></li>
<li><a href="#canal2-3-2-基于已有-docker-容器">2.3.2 基于已有 docker 容器</a></li>
<li><a href="#canal2-3-3-mysql-准备">2.3.3 mysql 准备</a></li>
<li><a href="#canal2-3-4-es-kibana">2.3.4 es + kibana</a></li>
<li><a href="#canal2-3-4-创建索引映射">2.3.4 创建索引映射</a></li>
</ul>
</li>
<li><a href="#canal2-4-canal-1-1-5-部署">2.4 canal-1.1.5 部署</a>
<ul class="sectlevel3">
<li><a href="#canal2-4-1-canal-deployer-配置">2.4.1 canal-deployer 配置</a></li>
<li><a href="#canal2-4-2-canal-deployer-启动">2.4.2 canal-deployer 启动</a></li>
<li><a href="#canal2-4-3-canal-adapter-配置">2.4.3 canal-adapter 配置</a></li>
</ul>
</li>
<li><a href="#canal2-5-新增商品">2.5 新增商品</a></li>
</ul>
</li>
<li><a href="#canalend">End</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<hr>
</div>
</div>
<div class="sect1">
<h2 id="canal1-优化商品树形接口">1. 优化商品树形接口</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
原因:
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>由于之前的实现存在数据连接占用问题,效果不好,需要优化为一次查询所有子类.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="canal1-1-解决方案">1.1 解决方案</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>通过 mybatis 结果映射中的 collection 集合标签递归查询,实现一次查出所有满足条件的分类数据,具体实现如下</p>
</div>
</div>
</div>
<details>
<summary class="title">接口方法</summary>
<div class="content">
<div class="listingblock">
<div class="title">GmsCategoryMapper</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#777">/**
 * 商品分类mapper接口
 */</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">GmsCategoryMapper</span> <span style="color:#088;font-weight:bold">extends</span> BaseMapper&lt;GmsCategoryDo&gt; {

    <span style="color:#777">/**
     * 查询分类树
     *
     * @param qry
     * @return
     */</span>
    <span style="color:#0a8;font-weight:bold">List</span>&lt;GmsCategoryPo&gt; listCate(GmsCategoryPageQry qry);

}</code></pre>
</div>
</div>
</div>
</details>
<details>
<summary class="title">mapper配置</summary>
<div class="content">
<div class="listingblock">
<div class="title">GmsCategoryMapper.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;resultMap</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">listCateMap</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">com.formssi.mall.goods.domain.repository.po.GmsCategoryPo</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;id</span> <span style="color:#b48">column</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">property</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;result</span> <span style="color:#b48">column</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">property</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;result</span> <span style="color:#b48">column</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">parent_id</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">property</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">parentId</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;result</span> <span style="color:#b48">column</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">image</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">property</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">image</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;result</span> <span style="color:#b48">column</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">level</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">property</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">level</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;result</span> <span style="color:#b48">column</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">priority</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">property</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">priority</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;result</span> <span style="color:#b48">column</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">option_status</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">property</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">optionStatus</span><span style="color:#710">&quot;</span></span> <span style="color:#070;font-weight:bold">/&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;collection</span> <span style="color:#b48">property</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">zList</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">select</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">getCateByParentId</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">column</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/resultMap&gt;</span>
    <span style="color:#777">&lt;!--根据条件查询类别--&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;select</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">listCate</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">resultMap</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">listCateMap</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
        SELECT id,name,parent_id,image,level,priority,option_status FROM gms_category
        <span style="color:#070;font-weight:bold">&lt;where&gt;</span>
            option_status = 1
            <span style="color:#070;font-weight:bold">&lt;if</span> <span style="color:#b48">test</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id != null</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
                and id = #{id}
            <span style="color:#070;font-weight:bold">&lt;/if&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;if</span> <span style="color:#b48">test</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">parentId != null</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
                and parent_id = #{parentId}
            <span style="color:#070;font-weight:bold">&lt;/if&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;if</span> <span style="color:#b48">test</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">level != null</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
                and level = #{level}
            <span style="color:#070;font-weight:bold">&lt;/if&gt;</span>
            ORDER BY priority DESC
        <span style="color:#070;font-weight:bold">&lt;/where&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/select&gt;</span>
    <span style="color:#777">&lt;!--通过parentId 查询所有子类--&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;select</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">getCateByParentId</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">resultMap</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">listCateMap</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
        SELECT id,name,parent_id,image,level,priority,option_status FROM gms_category
        <span style="color:#070;font-weight:bold">&lt;where&gt;</span>
            option_status = 1
            <span style="color:#070;font-weight:bold">&lt;if</span> <span style="color:#b48">test</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id != null</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
                and parent_id = #{id}
            <span style="color:#070;font-weight:bold">&lt;/if&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/where&gt;</span>
        ORDER BY priority DESC
    <span style="color:#070;font-weight:bold">&lt;/select&gt;</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="canal1-2-测试结果">1.2 测试结果</h3>
<details>
<summary class="title">请求参数</summary>
<div class="content">
<div class="listingblock">
<div class="title">10.31.3.43:18084/gms/cate</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span style="color:#606"><span style="color:#404">&quot;</span><span>level</span><span style="color:#404">&quot;</span></span>:<span style="color:#00D">0</span>
}</code></pre>
</div>
</div>
</div>
</details>
<details>
<summary class="title">响应结果</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span style="color:#606"><span style="color:#404">&quot;</span><span>code</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">200</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>message</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">请求成功</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>body</span><span style="color:#404">&quot;</span></span>: [
        {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">手机</span><span style="color:#710">&quot;</span></span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>parentId</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">0</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>image</span><span style="color:#404">&quot;</span></span>: <span style="color:#088">null</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>level</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">0</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>priority</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">9</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>optionStatus</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>zlist</span><span style="color:#404">&quot;</span></span>: [
                {
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">4</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">智能手机</span><span style="color:#710">&quot;</span></span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>parentId</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>image</span><span style="color:#404">&quot;</span></span>: <span style="color:#088">null</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>level</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>priority</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">9</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>optionStatus</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>zlist</span><span style="color:#404">&quot;</span></span>: [
                        {
                            <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">7</span>,
                            <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">商务智能手机</span><span style="color:#710">&quot;</span></span>,
                            <span style="color:#606"><span style="color:#404">&quot;</span><span>parentId</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">4</span>,
                            <span style="color:#606"><span style="color:#404">&quot;</span><span>image</span><span style="color:#404">&quot;</span></span>: <span style="color:#088">null</span>,
                            <span style="color:#606"><span style="color:#404">&quot;</span><span>level</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">2</span>,
                            <span style="color:#606"><span style="color:#404">&quot;</span><span>priority</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">9</span>,
                            <span style="color:#606"><span style="color:#404">&quot;</span><span>optionStatus</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                            <span style="color:#606"><span style="color:#404">&quot;</span><span>zlist</span><span style="color:#404">&quot;</span></span>: []
                        }
                    ]
                },
                {
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">5</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">老人机</span><span style="color:#710">&quot;</span></span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>parentId</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>image</span><span style="color:#404">&quot;</span></span>: <span style="color:#088">null</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>level</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>priority</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">8</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>optionStatus</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>zlist</span><span style="color:#404">&quot;</span></span>: []
                },
                {
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">6</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">对讲机</span><span style="color:#710">&quot;</span></span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>parentId</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>image</span><span style="color:#404">&quot;</span></span>: <span style="color:#088">null</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>level</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>priority</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">7</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>optionStatus</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
                    <span style="color:#606"><span style="color:#404">&quot;</span><span>zlist</span><span style="color:#404">&quot;</span></span>: []
                }
            ]
        },
        {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">2</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">蔬菜</span><span style="color:#710">&quot;</span></span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>parentId</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">0</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>image</span><span style="color:#404">&quot;</span></span>: <span style="color:#088">null</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>level</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">0</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>priority</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">8</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>optionStatus</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>zlist</span><span style="color:#404">&quot;</span></span>: []
        },
        {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">3</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">水果</span><span style="color:#710">&quot;</span></span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>parentId</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">0</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>image</span><span style="color:#404">&quot;</span></span>: <span style="color:#088">null</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>level</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">0</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>priority</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">7</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>optionStatus</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1</span>,
            <span style="color:#606"><span style="color:#404">&quot;</span><span>zlist</span><span style="color:#404">&quot;</span></span>: []
        }
    ],
    <span style="color:#606"><span style="color:#404">&quot;</span><span>ok</span><span style="color:#404">&quot;</span></span>: <span style="color:#088">true</span>
}</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<div class="sect1">
<h2 id="canal2-研究商品搜索">2. 研究商品搜索</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
需求 :
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>研究一个方案把商品信息同步到 ElasticSearch</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="canal2-1-方案选择">2.1 方案选择</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>通过查找之后,可执行 mysql 数据到 es 的插件有:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>elasticsearch-jdbc</p>
</li>
<li>
<p>elasticsearch-river-Mysql</p>
</li>
<li>
<p>go-mysql-elasticsearch</p>
</li>
<li>
<p>logstash-input-jdbc</p>
</li>
<li>
<p>canal</p>
</li>
<li>
<p>DTS (闭源)</p>
</li>
<li>
<p>CloudCanal  (闭源)</p>
</li>
<li>
<p>maxwell(直接将binlog解析成json存储在kafka中)</p>
</li>
<li>
<p>debezium (debezium同时支持源端MySQL和Postgres、MongoDB,需要kafka支持)</p>
</li>
<li>
<p>DataBus (Linkedin开源作品)</p>
</li>
<li>
<p>DataX (与 DataBus 类似,但是抓取数据方式为定时抓取)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="canal2-1-1-插件优缺点对比">2.1.1 插件优缺点对比</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. tables10</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">序号</th>
<th class="tableblock halign-left valign-top">插件名称</th>
<th class="tableblock halign-left valign-top">优点</th>
<th class="tableblock halign-left valign-top">不足</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elasticsearch-jdbc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.相对通用, 2.版本更新角度,GitHub活跃度很高</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不能实现同步删除操作,mysql删除了,es中仍然存在</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elasticsearch-river-Mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">未了解</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012年之后没有继续更新了</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">go-mysql-elasticsearch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">能实现同步增,删,改,查操作</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GitHub活跃度不高,最近一次更新两年前</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logstash-input-jdbc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">能实现同步增,改操作,版本更新迭代快,相对稳定,作为es固有插件logstash一部分,易用.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不能同步实现删除操作,mysql删除了,es中值仍然存在,需要定时扫描数据库,数据存在延迟</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">canal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">基于数据库增量日志解析，提供增量数据订阅 &amp; 消费,可配置高可用集群</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.不能同步实现删除操作,二进制日志格式必须为 row 模式,2.同步的表必须要有主键,3.支持部分ddl同步，ddl语句不支持幂等性操作,4.不支持带外键的记录同步</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="canal2-2-canal-介绍">2.2 canal 介绍</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Canal是阿里巴巴开源的数据库Binlog日志解析框架，主要用途是基于 MySQL 数据库增量日志解析，提供增量数据订阅和消费。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="canal2-2-1-canal-简介">2.2.1 canal 简介</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
简介
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/canal/canal-frame.png" alt="简介">
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>canal [kə&#8217;næl]，译意为水道/管道/沟渠，主要用途是基于 MySQL 数据库增量日志解析，提供增量数据订阅和消费</p>
</div>
<div class="paragraph">
<p>早期阿里巴巴因为杭州和美国双机房部署，存在跨机房同步的业务需求，实现方式主要是基于业务 trigger 获取增量变更。从 2010 年开始，业务逐步尝试数据库日志解析获取增量变更进行同步，由此衍生出了大量的数据库增量订阅和消费业务。</p>
</div>
<div class="paragraph">
<p>基于日志增量订阅和消费的业务包括</p>
</div>
<div class="ulist">
<ul>
<li>
<p>数据库镜像</p>
</li>
<li>
<p>数据库实时备份</p>
</li>
<li>
<p>索引构建和实时维护(拆分异构索引、倒排索引等)</p>
</li>
<li>
<p>业务 cache 刷新</p>
</li>
<li>
<p>带业务逻辑的增量数据处理</p>
</li>
<li>
<p>当前的 canal 支持源端 MySQL 版本包括 5.1.x , 5.5.x , 5.6.x , 5.7.x , 8.0.x</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="canal2-2-2-工作原理">2.2.2 工作原理</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
mysql 主从复制原理
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/canal/mysql_m_s.png" alt="mysql 主从复制">
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>MySQL master 将数据变更写入二进制日志( binary log, 其中记录叫做二进制日志事件binary log events，可以通过 show binlog events 进行查看)</p>
</li>
<li>
<p>MySQL slave 将 master 的 binary log events 拷贝到它的中继日志(relay log)</p>
</li>
<li>
<p>MySQL slave 重放 relay log 中事件，将数据变更反映它自己的数据</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
canal 工作原理
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/canal/canal_work.png" alt="canal工作原理">
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>canal 模拟 MySQL slave 的交互协议，伪装自己为 MySQL slave ，向 MySQL master 发送dump 协议</p>
</li>
<li>
<p>MySQL master 收到 dump 请求，开始推送 binary log 给 slave (即 canal )</p>
</li>
<li>
<p>canal 解析 binary log 对象(原始为 byte 流)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="canal2-3-单机部署-canal-1-1-5">2.3 单机部署 canal-1.1.5</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>初次尝试,选择本地单机部署 canal,后续可以打包成镜像通过 docker 部署</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="canal2-3-1-环境准备">2.3.1 环境准备</h4>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>服务器ip :10.207.0.169</p>
</li>
<li>
<p>ssh用户/密码 : root/formssi!!</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="canal2-3-2-基于已有-docker-容器">2.3.2 基于已有 docker 容器</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
在efk服务器的基础上尝试部署
</td>
</tr>
</table>
</div>
<details>
<summary class="title">服务器已有容器</summary>
<div class="content">
<div class="listingblock">
<div class="title">mysql-test,elasticsearch,kibana</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">[root@localhost ~]# docker ps
CONTAINER ID        IMAGE                                    COMMAND                  CREATED             STATUS              PORTS                                            NAMES
d24348476ce1        docker.elastic.co/beats/filebeat:7.7.1   &quot;/usr/local/bin/do...&quot;   8 days ago          Up 6 days                                                            filebeat
9b48a2161558        elastic/kibana:7.7.1                     &quot;/usr/local/bin/du...&quot;   8 days ago          Up 8 days           0.0.0.0:5601-&gt;5601/tcp                           kibana
f070ba380dd9        elasticsearch:7.7.1                      &quot;/tini -- /usr/loc...&quot;   8 days ago          Up 8 days           0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp   elasticsearch
404ee9e20e9d        nginx                                    &quot;/docker-entrypoin...&quot;   3 weeks ago         Up 3 weeks          0.0.0.0:8080-&gt;80/tcp                             nginx-test
ea7d0ccb18cf        mysql                                    &quot;docker-entrypoint...&quot;   3 weeks ago         Up 3 weeks          0.0.0.0:3306-&gt;3306/tcp, 33060/tcp                mysql-test
5f0c38c5ca20        mongo                                    &quot;docker-entrypoint...&quot;   3 weeks ago         Up 3 weeks          0.0.0.0:27017-&gt;27017/tcp                         mongodb
15098c48f946        redis                                    &quot;docker-entrypoint...&quot;   3 weeks ago         Up 3 weeks          0.0.0.0:6379-&gt;6379/tcp                           redis</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="canal2-3-3-mysql-准备">2.3.3 mysql 准备</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
mysql 日志开启 , row模式
</td>
</tr>
</table>
</div>
<details>
<summary class="title">mysql配置</summary>
<div class="content">
<div class="listingblock">
<div class="title">binlog,formate,master status</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mysql&gt; show master status;
+---------------+----------+--------------+------------------+-------------------+
| File          | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+---------------+----------+--------------+------------------+-------------------+
| binlog.000002 |    64287 |              |                  |                   |
+---------------+----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)

mysql&gt; show variables like 'log_bin';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| log_bin       | ON    |
+---------------+-------+
1 row in set (0.01 sec)

mysql&gt; show variables like 'binlog_format';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| binlog_format | ROW   |
+---------------+-------+
1 row in set (0.01 sec)</code></pre>
</div>
</div>
</div>
</details>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
slave 用户创建
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>授权 canal 链接 MySQL 账号具有作为 MySQL slave 的权限, 如果已有账户可直接 grant</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 1. 创建用户并授权</div>
<div class="content">
<div class="listingblock">
<div class="title">创建用户</div>
<div class="content">
<pre>CREATE USER canal IDENTIFIED BY 'canal';</pre>
</div>
</div>
<div class="listingblock">
<div class="title">赋权</div>
<div class="content">
<pre>GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'canal'@'%';
-- GRANT ALL PRIVILEGES ON *.* TO 'canal'@'%' ;</pre>
</div>
</div>
<div class="listingblock">
<div class="title">刷新使立即生效</div>
<div class="content">
<pre>FLUSH PRIVILEGES;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="canal2-3-4-es-kibana">2.3.4 es + kibana</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
es + kibana 环境验证
</td>
</tr>
</table>
</div>
<details>
<summary class="title">es rest接口可用</summary>
<div class="content">
<div class="listingblock">
<div class="title"><a href="http://10.207.0.169:9200/" class="bare">http://10.207.0.169:9200/</a></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">f070ba380dd9</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>cluster_name</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">elasticsearch</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>cluster_uuid</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">zcqSJ8VfQ06tknhtzE_qYw</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>version</span><span style="color:#404">&quot;</span></span> : {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>number</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">7.7.1</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>build_flavor</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">default</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>build_type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">docker</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>build_hash</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ad56dce891c901a492bb1ee393f12dfff473a423</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>build_date</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2020-05-28T16:30:01.040088Z</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>build_snapshot</span><span style="color:#404">&quot;</span></span> : <span style="color:#088">false</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>lucene_version</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">8.5.1</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>minimum_wire_compatibility_version</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">6.8.0</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>minimum_index_compatibility_version</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">6.0.0-beta1</span><span style="color:#710">&quot;</span></span>
  },
  <span style="color:#606"><span style="color:#404">&quot;</span><span>tagline</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">You Know, for Search</span><span style="color:#710">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</details>
<details>
<summary class="title">kiban 检查 <a href="http://10.207.0.169:5601/app/kibana#/dev_tools/console" class="bare">http://10.207.0.169:5601/app/kibana#/dev_tools/console</a></summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/canal/kibana_console.png" alt="kibana">
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="canal2-3-4-创建索引映射">2.3.4 创建索引映射</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
通过post提交可以自动创建索引映射,可以用这个模板修改映射再重新创建索引
</td>
</tr>
</table>
</div>
<details>
<summary class="title">gms_spu es 索引结构</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>gms_spu</span><span style="color:#404">&quot;</span></span> : {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>aliases</span><span style="color:#404">&quot;</span></span> : { },
    <span style="color:#606"><span style="color:#404">&quot;</span><span>mappings</span><span style="color:#404">&quot;</span></span> : {
      <span style="color:#606"><span style="color:#404">&quot;</span><span>properties</span><span style="color:#404">&quot;</span></span> : {
        <span style="color:#606"><span style="color:#404">&quot;</span><span>approvalStatus</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>approval_status</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>catalogId</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>catalog_id</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>createTime</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">date</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>enableIntegral</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>enable_integral</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>image</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>introduce</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>marketPrice</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">float</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>market_price</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>optionStatus</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>option_status</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>price</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">float</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>priority</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>refuseReason</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>refuse_reason</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>spuSn</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>spuStatus</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>spu_images</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>spu_sn</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>spu_status</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>sub_title</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>fields</span><span style="color:#404">&quot;</span></span> : {
            <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : {
              <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">keyword</span><span style="color:#710">&quot;</span></span>,
              <span style="color:#606"><span style="color:#404">&quot;</span><span>ignore_above</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">256</span>
            }
          }
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>totalComment</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>totalSales</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>totalScore</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">float</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>total_comment</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>total_sales</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>total_score</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">float</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>updateTime</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">date</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>virtualStock</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>virtual_stock</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">long</span><span style="color:#710">&quot;</span></span>
        }
      }
    },
    <span style="color:#606"><span style="color:#404">&quot;</span><span>settings</span><span style="color:#404">&quot;</span></span> : {
      <span style="color:#606"><span style="color:#404">&quot;</span><span>index</span><span style="color:#404">&quot;</span></span> : {
        <span style="color:#606"><span style="color:#404">&quot;</span><span>creation_date</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1651128188641</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>number_of_shards</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>number_of_replicas</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>uuid</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">-oqf1aqRRdGL4NHaGeuSvA</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>version</span><span style="color:#404">&quot;</span></span> : {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>created</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">7070199</span><span style="color:#710">&quot;</span></span>
        },
        <span style="color:#606"><span style="color:#404">&quot;</span><span>provided_name</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">gms_spu</span><span style="color:#710">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="canal2-4-canal-1-1-5-部署">2.4 canal-1.1.5 部署</h3>
<details>
<summary class="title">Asserts</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/canal/canal_gz.png" alt="canal-1.1.5 包">
</div>
</div>
</div>
</details>
<div class="exampleblock">
<div class="title">Example 2. 解压缩如下</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">[root@localhost canal]# ll
总用量 288992
drwxr-xr-x. 7 root root       100 4月  26 11:46 canal-adapter
-rw-r--r--. 1 root root 197350026 4月  26 09:57 canal.adapter-1.1.5.tar.gz
drwxr-xr-x. 6 root root        52 4月  26 10:03 canal-admin
-rw-r--r--. 1 root root  38366781 4月  26 09:56 canal.admin-1.1.5.tar.gz
drwxr-xr-x. 7 root root       101 4月  26 10:39 canal-deployer
-rw-r--r--. 1 root root  60205298 4月  26 09:59 canal.deployer-1.1.5.tar.gz</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 3. 源码</div>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/canal/canal_source.png" alt="源码">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="canal2-4-1-canal-deployer-配置">2.4.1 canal-deployer 配置</h4>
<div class="exampleblock">
<div class="title">Example 4. 修改配置</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>vi conf/example/instance.properties</pre>
</div>
</div>
</div>
</div>
<details>
<summary class="title">instance.properties</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#777">#################################################</span>
<span style="color:#777">## mysql serverId , v1.0.26+ will autoGen</span>
 <span style="color:#F00;background-color:#FAA">canal.instance.mysql.slaveId=123  # slaveserver id 服务器唯一id</span>

<span style="color:#777"># enable gtid use true/false</span>
<span style="color:#F00;background-color:#FAA">canal.instance.gtidon=false</span>

<span style="color:#777"># position info</span>
<span style="color:#F00;background-color:#FAA">canal.instance.master.address=localhost:3306  # mysql主服务器位置</span>
<span style="color:#F00;background-color:#FAA">canal.instance.master.journal.name=</span>
<span style="color:#F00;background-color:#FAA">canal.instance.master.position=</span>
<span style="color:#F00;background-color:#FAA">canal.instance.master.timestamp=</span>
<span style="color:#F00;background-color:#FAA">canal.instance.master.gtid=</span>

<span style="color:#777"># rds oss binlog</span>
<span style="color:#F00;background-color:#FAA">canal.instance.rds.accesskey=</span>
<span style="color:#F00;background-color:#FAA">canal.instance.rds.secretkey=</span>
<span style="color:#F00;background-color:#FAA">canal.instance.rds.instanceId=</span>

<span style="color:#777"># table meta tsdb info</span>
<span style="color:#F00;background-color:#FAA">canal.instance.tsdb.enable=false</span>
<span style="color:#777">#canal.instance.tsdb.url=jdbc:mysql://127.0.0.1:3306</span>
<span style="color:#777">#canal.instance.tsdb.dbUsername=canal</span>
<span style="color:#777">#canal.instance.tsdb.dbPassword=canal</span>

<span style="color:#777">#canal.instance.standby.address =</span>
<span style="color:#777">#canal.instance.standby.journal.name =</span>
<span style="color:#777">#canal.instance.standby.position =</span>
<span style="color:#777">#canal.instance.standby.timestamp =</span>
<span style="color:#777">#canal.instance.standby.gtid=</span>

<span style="color:#777"># username/password</span>
<span style="color:#F00;background-color:#FAA">canal.instance.dbUsername=canal  # slave 用户名</span>
<span style="color:#F00;background-color:#FAA">canal.instance.dbPassword=canal  # slave 密码</span>
<span style="color:#F00;background-color:#FAA">canal.instance.defaultDatabaseName=canal_test #默认同步数据库</span>
<span style="color:#F00;background-color:#FAA">canal.instance.connectionCharset = UTF-8</span>
<span style="color:#777"># enable druid Decrypt database password</span>
<span style="color:#F00;background-color:#FAA">canal.instance.enableDruid=false</span>
<span style="color:#777">#canal.instance.pwdPublicKey=MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALK4BUxdDltRRE5/zXpVEVPUgunvscYFtEip3pmLlhrWpacX7y7GCMo2/JM6LeHmiiNdH1FWgGCpUfircSwlWKUCAwEAAQ==</span>

<span style="color:#777"># table regex</span>
<span style="color:#F00;background-color:#FAA">canal.instance.filter.regex=.*\\..*  #同步所有表</span>
<span style="color:#777"># table black regex</span>
<span style="color:#F00;background-color:#FAA">canal.instance.filter.black.regex=mysql\\.slave_.*</span>
<span style="color:#777"># table field filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)</span>
<span style="color:#777">#canal.instance.filter.field=test1.t_product:id/subject/keywords,test2.t_company:id/name/contact/ch</span>
<span style="color:#777"># table field black filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)</span>
<span style="color:#777">#canal.instance.filter.black.field=test1.t_product:subject/product_image,test2.t_company:id/name/contact/ch</span>

<span style="color:#777"># mq config</span>
<span style="color:#F00;background-color:#FAA">canal.mq.topic=example</span>
<span style="color:#777"># dynamic topic route by schema or table regex</span>
<span style="color:#777">#canal.mq.dynamicTopic=mytest1.user,mytest2\\..*,.*\\..*</span>
<span style="color:#F00;background-color:#FAA">canal.mq.partition=0</span>
<span style="color:#777"># hash partition config</span>
<span style="color:#777">#canal.mq.partitionsNum=3</span>
<span style="color:#777">#canal.mq.partitionHash=test.table:id^name,.*\\..*</span>
<span style="color:#777">#canal.mq.dynamicTopicPartitionNum=test.*:4,mycanal:6</span>
<span style="color:#777">#################################################</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>canal.instance.connectionCharset 代表数据库的编码方式对应到 java 中的编码类型，比如 UTF-8，GBK , ISO-8859-1</p>
</li>
<li>
<p>如果系统是1个 cpu，需要将 canal.instance.parser.parallel 设置为 false</p>
</li>
</ul>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="canal2-4-2-canal-deployer-启动">2.4.2 canal-deployer 启动</h4>
<div class="listingblock">
<div class="title">启动</div>
<div class="content">
<pre>sh bin/startup.sh</pre>
</div>
</div>
<details>
<summary class="title">启动详情</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>[root@localhost canal-deployer]# sh bin/startup.sh
cd to /root/docker/canal/canal-deployer/bin for workaround relative path
LOG CONFIGURATION : /root/docker/canal/canal-deployer/bin/../conf/logback.xml
canal conf : /root/docker/canal/canal-deployer/bin/../conf/canal.properties
CLASSPATH :/root/docker/canal/canal-deployer/bin/../conf:/root/docker/canal/canal-deployer/bin/../lib/zookeeper-3.4.5.jar:/root/docker/canal/canal-deployer/bin/../lib/zkclient-0.10.jar:/root/docker/canal/canal-deployer/bin/../lib/spring-tx-5.0.5.RELEASE.jar:/root/docker/canal/canal-deployer/bin/../lib/spring-orm-5.0.5.RELEASE.jar:/root/docker/canal/canal-deployer/bin/../lib/spring-jdbc-5.0.5.RELEASE.jar:/root/docker/canal/canal-deployer/bin/../lib/spring-jcl-5.0.5.RELEASE.jar:/root/docker/canal/canal-deployer/bin/../lib/spring-expression-5.0.5.RELEASE.jar:/root/docker/canal/canal-deployer/bin/../lib/spring-core-5.0.5.RELEASE.jar:/root/docker/canal/canal-deployer/bin/../lib/spring-context-5.0.5.RELEASE.jar:/root/docker/canal/canal-deployer/bin/../lib/spring-beans-5.0.5.RELEASE.jar:/root/docker/canal/canal-deployer/bin/../lib/spring-aop-5.0.5.RELEASE.jar:/root/docker/canal/canal-deployer/bin/../lib/slf4j-api-1.7.12.jar:/root/docker/canal/canal-deployer/bin/../lib/simpleclient_pushgateway-0.4.0.jar:/root/docker/canal/canal-deployer/bin/../lib/simpleclient_httpserver-0.4.0.jar:/root/docker/canal/canal-deployer/bin/../lib/simpleclient_hotspot-0.4.0.jar:/root/docker/canal/canal-deployer/bin/../lib/simpleclient_common-0.4.0.jar:/root/docker/canal/canal-deployer/bin/../lib/simpleclient-0.4.0.jar:/root/docker/canal/canal-deployer/bin/../lib/protobuf-java-3.6.1.jar:/root/docker/canal/canal-deployer/bin/../lib/oro-2.0.8.jar:/root/docker/canal/canal-deployer/bin/../lib/netty-all-4.1.6.Final.jar:/root/docker/canal/canal-deployer/bin/../lib/netty-3.2.2.Final.jar:/root/docker/canal/canal-deployer/bin/../lib/mysql-connector-java-5.1.48.jar:/root/docker/canal/canal-deployer/bin/../lib/mybatis-spring-2.0.4.jar:/root/docker/canal/canal-deployer/bin/../lib/mybatis-3.5.4.jar:/root/docker/canal/canal-deployer/bin/../lib/logback-core-1.1.3.jar:/root/docker/canal/canal-deployer/bin/../lib/logback-classic-1.1.3.jar:/root/docker/canal/canal-deployer/bin/../lib/jsr305-3.0.2.jar:/root/docker/canal/canal-deployer/bin/../lib/joda-time-2.9.4.jar:/root/docker/canal/canal-deployer/bin/../lib/jctools-core-2.1.2.jar:/root/docker/canal/canal-deployer/bin/../lib/jcl-over-slf4j-1.7.12.jar:/root/docker/canal/canal-deployer/bin/../lib/javax.annotation-api-1.3.2.jar:/root/docker/canal/canal-deployer/bin/../lib/j2objc-annotations-1.1.jar:/root/docker/canal/canal-deployer/bin/../lib/httpcore-4.4.3.jar:/root/docker/canal/canal-deployer/bin/../lib/httpclient-4.5.1.jar:/root/docker/canal/canal-deployer/bin/../lib/h2-1.4.196.jar:/root/docker/canal/canal-deployer/bin/../lib/guava-22.0.jar:/root/docker/canal/canal-deployer/bin/../lib/fastjson-1.2.58.sec06.jar:/root/docker/canal/canal-deployer/bin/../lib/error_prone_annotations-2.0.18.jar:/root/docker/canal/canal-deployer/bin/../lib/druid-1.2.6.jar:/root/docker/canal/canal-deployer/bin/../lib/disruptor-3.4.2.jar:/root/docker/canal/canal-deployer/bin/../lib/connector.core-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/commons-logging-1.2.jar:/root/docker/canal/canal-deployer/bin/../lib/commons-lang3-3.7.jar:/root/docker/canal/canal-deployer/bin/../lib/commons-lang-2.6.jar:/root/docker/canal/canal-deployer/bin/../lib/commons-io-2.4.jar:/root/docker/canal/canal-deployer/bin/../lib/commons-compress-1.9.jar:/root/docker/canal/canal-deployer/bin/../lib/commons-codec-1.9.jar:/root/docker/canal/canal-deployer/bin/../lib/commons-beanutils-1.8.2.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.store-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.sink-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.server-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.protocol-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.prometheus-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.parse.driver-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.parse.dbsync-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.parse-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.meta-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.instance.spring-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.instance.manager-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.instance.core-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.filter-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.deployer-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/canal.common-1.1.5.jar:/root/docker/canal/canal-deployer/bin/../lib/aviator-2.2.1.jar:/root/docker/canal/canal-deployer/bin/../lib/animal-sniffer-annotations-1.14.jar:
cd to /root/docker/canal/canal-deployer for continue</pre>
</div>
</div>
</div>
</details>
<div class="listingblock">
<div class="title">查看日志</div>
<div class="content">
<pre>vi logs/example/example.log</pre>
</div>
</div>
<details>
<summary class="title">日志</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">2022-04-28 10:48:45.982 [main] INFO  c.a.otter.canal.instance.spring.CanalInstanceWithSpring - start CannalInstance for 1-example
2022-04-28 10:48:45.997 [main] WARN  c.a.o.canal.parse.inbound.mysql.dbsync.LogEventConvert - --&gt; init table filter : ^.*\..*$
2022-04-28 10:48:45.997 [main] WARN  c.a.o.canal.parse.inbound.mysql.dbsync.LogEventConvert - --&gt; init table black filter : ^mysql\.slave_.*$
2022-04-28 10:48:46.057 [destination = example , address = localhost/127.0.0.1:3306 , EventParser] WARN  c.a.o.c.p.inbound.mysql.rds.RdsBinlogEventParserProxy - ---&gt; begin to find start position, it will be long time for reset or first position
2022-04-28 10:48:46.107 [main] INFO  c.a.otter.canal.instance.core.AbstractCanalInstance - start successful....
2022-04-28 10:48:46.133 [destination = example , address = localhost/127.0.0.1:3306 , EventParser] WARN  c.a.o.c.p.inbound.mysql.rds.RdsBinlogEventParserProxy - prepare to find start position just last position
 {&quot;identity&quot;:{&quot;slaveId&quot;:-1,&quot;sourceAddress&quot;:{&quot;address&quot;:&quot;localhost&quot;,&quot;port&quot;:3306}},&quot;postion&quot;:{&quot;gtid&quot;:&quot;&quot;,&quot;included&quot;:false,&quot;journalName&quot;:&quot;binlog.000002&quot;,&quot;position&quot;:64256,&quot;serverId&quot;:1,&quot;timestamp&quot;:1650965306000}}
2022-04-28 10:48:46.151 [destination = example , address = localhost/127.0.0.1:3306 , EventParser] WARN  c.a.o.c.p.inbound.mysql.rds.RdsBinlogEventParserProxy - ---&gt; find start position successfully, EntryPosition[included=false,journalName=binlog.000002,position=64256,serverId=1,gtid=,timestamp=1650965306000] cost : 76ms , the next step is binlog dump</code></pre>
</div>
</div>
</div>
</details>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>AbstractCanalInstance - start successful&#8230;&#8203;.  表示canal-deployer 启动成功</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="canal2-4-3-canal-adapter-配置">2.4.3 canal-adapter 配置</h4>
<div class="sidebarblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
canal-adapter 适配器自动转发增量数据
</td>
</tr>
</table>
</div>
</div>
</div>
<details>
<summary class="title">canal-adapter 相关配置</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">server</span>:
  <span style="color:#606">port</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">8081</span></span>
<span style="color:#606">spring</span>:
  <span style="color:#606">jackson</span>:
    <span style="color:#606">date-format</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">yyyy-MM-dd HH:mm:ss</span></span>
    <span style="color:#606">time-zone</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">GMT+8</span></span>
    <span style="color:#606">default-property-inclusion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">non_null</span></span>

<span style="color:#606">canal.conf</span>:
  <span style="color:#606">mode</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">tcp</span></span> <span style="color:#777">#tcp kafka rocketMQ rabbitMQ</span>
  <span style="color:#606">flatMessage</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
  <span style="color:#606">zookeeperHosts</span>:
  <span style="color:#606">syncBatchSize</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1000</span></span>
  <span style="color:#606">retries</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">0</span></span>
  <span style="color:#606">timeout</span>:
  <span style="color:#606">accessKey</span>:
  <span style="color:#606">secretKey</span>:
  <span style="color:#606">consumerProperties</span>:
    <span style="color:#777"># canal tcp consumer</span>
    <span style="color:#606">canal.tcp.server.host</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">127.0.0.1:11111</span></span>
    <span style="color:#606">canal.tcp.zookeeper.hosts</span>:
    <span style="color:#606">canal.tcp.batch.size</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">500</span></span>
    <span style="color:#606">canal.tcp.username</span>:
    <span style="color:#606">canal.tcp.password</span>:
    <span style="color:#777"># kafka consumer</span>
    <span style="color:#606">kafka.bootstrap.servers</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">127.0.0.1:9092</span></span>
    <span style="color:#606">kafka.enable.auto.commit</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
    <span style="color:#606">kafka.auto.commit.interval.ms</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1000</span></span>
    <span style="color:#606">kafka.auto.offset.reset</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">latest</span></span>
    <span style="color:#606">kafka.request.timeout.ms</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">40000</span></span>
    <span style="color:#606">kafka.session.timeout.ms</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">30000</span></span>
    <span style="color:#606">kafka.isolation.level</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">read_committed</span></span>
    <span style="color:#606">kafka.max.poll.records</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1000</span></span>
    <span style="color:#777"># rocketMQ consumer</span>
    <span style="color:#606">rocketmq.namespace</span>:
    <span style="color:#606">rocketmq.namesrv.addr</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">127.0.0.1:9876</span></span>
    <span style="color:#606">rocketmq.batch.size</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1000</span></span>
    <span style="color:#606">rocketmq.enable.message.trace</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
    <span style="color:#606">rocketmq.customized.trace.topic</span>:
    <span style="color:#606">rocketmq.access.channel</span>:
    <span style="color:#606">rocketmq.subscribe.filter</span>:
    <span style="color:#777"># rabbitMQ consumer</span>
    <span style="color:#606">rabbitmq.host</span>:
    <span style="color:#606">rabbitmq.virtual.host</span>:
    <span style="color:#606">rabbitmq.username</span>:
    <span style="color:#606">rabbitmq.password</span>:
    <span style="color:#606">rabbitmq.resource.ownerId</span>:

  <span style="color:#606">srcDataSources</span>:
    <span style="color:#606">defaultDS</span>:
      <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">jdbc:mysql://10.207.0.169:3306/canal_test?useUnicode=true&amp;characterEncoding=UTF-8&amp;allowPublicKeyRetrieval=true&amp;useSSL=false</span></span>
      <span style="color:#606">username</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">root</span></span>
      <span style="color:#606">password</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">123456</span></span>
  <span style="color:#606">canalAdapters</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">instance: example</span></span> <span style="color:#777"># canal instance Name or mq topic name</span>
    <span style="color:#606">groups</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">groupId: g1</span></span>
      <span style="color:#606">outerAdapters</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: logger</span></span>
<span style="color:#777">#      - name: rdb</span>
<span style="color:#777">#        key: mysql1</span>
<span style="color:#777">#        properties:</span>
<span style="color:#777">#          jdbc.driverClassName: com.mysql.jdbc.Driver</span>
<span style="color:#777">#          jdbc.url: jdbc:mysql://127.0.0.1:3306/mytest2?useUnicode=true</span>
<span style="color:#777">#          jdbc.username: root</span>
<span style="color:#777">#          jdbc.password: 121212</span>
<span style="color:#777">#      - name: rdb</span>
<span style="color:#777">#        key: oracle1</span>
<span style="color:#777">#        properties:</span>
<span style="color:#777">#          jdbc.driverClassName: oracle.jdbc.OracleDriver</span>
<span style="color:#777">#          jdbc.url: jdbc:oracle:thin:@localhost:49161:XE</span>
<span style="color:#777">#          jdbc.username: mytest</span>
<span style="color:#777">#          jdbc.password: m121212</span>
<span style="color:#777">#      - name: rdb</span>
<span style="color:#777">#        key: postgres1</span>
<span style="color:#777">#        properties:</span>
<span style="color:#777">#          jdbc.driverClassName: org.postgresql.Driver</span>
<span style="color:#777">#          jdbc.url: jdbc:postgresql://localhost:5432/postgres</span>
<span style="color:#777">#          jdbc.username: postgres</span>
<span style="color:#777">#          jdbc.password: 121212</span>
<span style="color:#777">#          threads: 1</span>
<span style="color:#777">#          commitSize: 3000</span>
<span style="color:#777">#      - name: hbase</span>
<span style="color:#777">#        properties:</span>
<span style="color:#777">#          hbase.zookeeper.quorum: 127.0.0.1</span>
<span style="color:#777">#          hbase.zookeeper.property.clientPort: 2181</span>
<span style="color:#777">#          zookeeper.znode.parent: /hbase</span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: es7</span></span>
        <span style="color:#606">hosts</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">localhost:9200</span></span> <span style="color:#777"># 127.0.0.1:9200 for rest mode</span>
        <span style="color:#606">properties</span>:
          <span style="color:#606">mode</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">rest</span></span>    <span style="color:#777"># transport # or rest</span>
<span style="color:#777">#          # security.auth: test:123456 #  only used for rest mode</span>
          <span style="color:#606">cluster.name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">elasticsearch</span></span>
<span style="color:#777">#        - name: kudu</span>
<span style="color:#777">#          key: kudu</span>
<span style="color:#777">#          properties:</span>
<span style="color:#777">#            kudu.master.address: 127.0.0.1 # ',' split multi address</span></code></pre>
</div>
</div>
</div>
</details>
<div class="exampleblock">
<div class="title">Example 5. 问题</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">2022-04-26 13:36:54.964 [main] INFO  org.elasticsearch.plugins.PluginsService - loaded plugin [org.elasticsearch.script.mustache.MustachePlugin]
2022-04-26 13:36:54.964 [main] INFO  org.elasticsearch.plugins.PluginsService - loaded plugin [org.elasticsearch.transport.Netty4Plugin]
2022-04-26 13:36:56.366 [main] INFO  c.a.o.c.client.adapter.es.core.config.ESSyncConfigLoader - ## Start loading es mapping config ...
2022-04-26 13:36:56.444 [main] INFO  c.a.o.c.client.adapter.es.core.config.ESSyncConfigLoader - ## ES mapping config loaded
2022-04-26 13:36:56.790 [main] ERROR c.a.o.canal.adapter.launcher.loader.CanalAdapterLoader - Load canal adapter: es7 failed
java.lang.RuntimeException: java.lang.RuntimeException: java.lang.ClassCastException: com.alibaba.druid.pool.DruidDataSource cannot be cast to com.alibaba.druid.pool.DruidDataSource
at com.alibaba.otter.canal.client.adapter.es7x.ES7xAdapter.init(ES7xAdapter.java:54) ~[client-adapter.es7x-1.1.5-jar-with-dependencies.jar:na]
at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterLoader.loadAdapter(CanalAdapterLoader.java:225) [client-adapter.launcher-1.1.5.jar:na]
at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterLoader.init(CanalAdapterLoader.java:56) [client-adapter.launcher-1.1.5.jar:n
a]
at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterService.init(CanalAdapterService.java:60) [client-adapter.launcher-1.1.5.jar:na]
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_322]
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_322]
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_322]
at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_322]
at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleElement.invoke(InitDestroyAnnotationBeanPostProcessor.java:365) [spring-beans-5.0.5.RELEASE.jar:5.0.5.RELEASE]
at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor$LifecycleMetadata.invokeInitMethods(InitDestroyAnnotationBeanPostProcessor.java:308) [spring-beans-5.0.5.RELEASE.jar:5.0.5.RELEASE]
at org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor.postProcessBeforeInitialization(InitDestroyAnnotationBeanPostProcessor.java:135) [spring-beans-5.0.5.RELEASE.jar:5.0.5.RELEASE]
at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:422) [spring-beans-5.0.5.RELEASE.jar:5.0.5.RELEASE]</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
原因是 druid 包冲突导致的
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 6. 解决</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>下载源码包</p>
</li>
<li>
<p>解压后，使用IDEA打开，定位到 client-adapter.escore 模块的 pom.xml 的 druid 更新为</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;druid&lt;/artifactId&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>更新后，通过maven插件打包(打包出错是maven版本过高导致jar包下载失败,降到maven3.6即可)</p>
</li>
<li>
<p>然后到 canal-canal-1.1.5/client-adapter/es7x/target 下 将打包好的 client-adapter.es7x-1.1.5-jar-with-dependencies.jar 替换掉 canal-adapter/plugin</p>
</li>
<li>
<p>重启 Canal Adapter</p>
</li>
</ul>
</div>
</div>
</div>
<details>
<summary class="title">重启日志</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">2022-04-28 11:17:00.015 [main] INFO  c.a.o.canal.adapter.launcher.loader.CanalAdapterLoader - Load canal adapter: logger succeed
2022-04-28 11:17:00.303 [main] INFO  c.a.o.c.client.adapter.es.core.config.ESSyncConfigLoader - ## Start loading es mapping config ...
2022-04-28 11:17:00.371 [main] INFO  c.a.o.c.client.adapter.es.core.config.ESSyncConfigLoader - ## ES mapping config loaded
2022-04-28 11:17:00.832 [main] INFO  c.a.o.canal.adapter.launcher.loader.CanalAdapterLoader - Load canal adapter: es7 succeed
2022-04-28 11:17:00.858 [main] INFO  c.alibaba.otter.canal.connector.core.spi.ExtensionLoader - extension classpath dir: /root/docker/canal/canal-adapter/plugin
2022-04-28 11:17:00.886 [main] INFO  c.a.o.canal.adapter.launcher.loader.CanalAdapterLoader - Start adapter for canal-client mq topic: example-g1 succeed
2022-04-28 11:17:00.887 [main] INFO  c.a.o.canal.adapter.launcher.loader.CanalAdapterService - ## the canal client adapters are running now ......
2022-04-28 11:17:00.887 [Thread-4] INFO  c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - =============&gt; Start to connect destination: example &lt;=============
2022-04-28 11:17:00.905 [main] INFO  org.apache.coyote.http11.Http11NioProtocol - Starting ProtocolHandler [&quot;http-nio-8081&quot;]
2022-04-28 11:17:00.909 [main] INFO  org.apache.tomcat.util.net.NioSelectorPool - Using a shared selector for servlet write/read
2022-04-28 11:17:00.930 [main] INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer - Tomcat started on port(s): 8081 (http) with context path ''
2022-04-28 11:17:00.942 [main] INFO  c.a.otter.canal.adapter.launcher.CanalAdapterApplication - Started CanalAdapterApplication in 4.595 seconds (JVM running for 5.2)
2022-04-28 11:17:01.087 [Thread-4] INFO  c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - =============&gt; Subscribe destination: example succeed &lt;=============</code></pre>
</div>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="canal2-5-新增商品">2.5 新增商品</h3>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>新增一个单表的spu</p>
</div>
<div class="listingblock">
<div class="title">spu_sql</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span style="color:#B06;font-weight:bold">insert</span> <span style="color:#B06;font-weight:bold">into</span> gms_spu (catalog_id,spu_sn,name,sub_title,image,introduce,price,market_price,total_sales,total_score,total_comment
            ,priority,spu_images,virtual_stock,enable_integral,spu_status,approval_status,refuse_reason,keyword,create_time,update_time,option_status)
<span style="color:#080;font-weight:bold">values</span> (<span style="color:#00D">4</span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">huawei-02</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">苹果手机</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Apple iPhone 13 (A2634)128GB 绿色 支持移动联通电信5G 双卡双待手机</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">https://img11.360buyimg.com/n1/s450x450_jfs/t1/213049/40/14248/57026/6227c9baEdf8e6336/5594ed4d66ef9647.jpg</span><span style="color:#710">'</span></span>,
<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">超明亮,超绚丽,超锐丽</span><span style="color:#710">'</span></span>,<span style="color:#60E">5999.00</span>,<span style="color:#60E">5999.00</span>,<span style="color:#00D">6000000</span>,<span style="color:#60E">98.7</span>,<span style="color:#00D">10000</span>,<span style="color:#00D">99</span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>,<span style="color:#00D">6000</span>,<span style="color:#00D">1000</span>,<span style="color:#00D">1</span>,<span style="color:#00D">1</span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">苹果手机</span><span style="color:#710">'</span></span>,<span style="color:#369;font-weight:bold">now</span>(),<span style="color:#369;font-weight:bold">now</span>(),<span style="color:#00D">1</span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">adapter 处理日志</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">2022-04-28 14:43:53.736 [pool-2-thread-1] INFO  c.a.o.canal.client.adapter.logger.LoggerAdapterExample - DML: {&quot;data&quot;:[{&quot;id&quot;:18,&quot;catalog_id&quot;:4,&quot;spu_sn&quot;:&quot;huawei-02&quot;,&quot;name&quot;:&quot;苹果手机&quot;,&quot;sub_title&quot;:&quot;Apple iPhone 13 (A2634)128GB 绿色 支持移动联通电信5G 双卡双待手机&quot;,&quot;image&quot;:&quot;https://img11.360buyimg.com/n1/s450x450_jfs/t1/213049/40/14248/57026/6227c9baEdf8e6336/5594ed4d66ef9647.jpg&quot;,&quot;introduce&quot;:&quot;超明亮,超绚丽,超锐丽&quot;,&quot;price&quot;:5999,&quot;market_price&quot;:5999,&quot;total_sales&quot;:6000000,&quot;total_score&quot;:98.7,&quot;total_comment&quot;:10000,&quot;priority&quot;:99,&quot;spu_images&quot;:&quot;&quot;,&quot;virtual_stock&quot;:6000,&quot;enable_integral&quot;:1000,&quot;spu_status&quot;:1,&quot;approval_status&quot;:1,&quot;refuse_reason&quot;:&quot;&quot;,&quot;keyword&quot;:&quot;苹果手机&quot;,&quot;create_time&quot;:1651099423000,&quot;update_time&quot;:1651099423000,&quot;option_status&quot;:1}],&quot;database&quot;:&quot;canal_test&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1651128223000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[&quot;id&quot;],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;gms_spu&quot;,&quot;ts&quot;:1651128233733,&quot;type&quot;:&quot;INSERT&quot;}
2022-04-28 14:43:53.745 [pool-2-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: {&quot;data&quot;:[{&quot;id&quot;:18,&quot;catalog_id&quot;:4,&quot;spu_sn&quot;:&quot;huawei-02&quot;,&quot;name&quot;:&quot;苹果手机&quot;,&quot;sub_title&quot;:&quot;Apple iPhone 13 (A2634)128GB 绿色 支持移动联通电信5G 双卡双待手机&quot;,&quot;image&quot;:&quot;https://img11.360buyimg.com/n1/s450x450_jfs/t1/213049/40/14248/57026/6227c9baEdf8e6336/5594ed4d66ef9647.jpg&quot;,&quot;introduce&quot;:&quot;超明亮,超绚丽,超锐丽&quot;,&quot;price&quot;:5999,&quot;market_price&quot;:5999,&quot;total_sales&quot;:6000000,&quot;total_score&quot;:98.7,&quot;total_comment&quot;:10000,&quot;priority&quot;:99,&quot;spu_images&quot;:&quot;&quot;,&quot;virtual_stock&quot;:6000,&quot;enable_integral&quot;:1000,&quot;spu_status&quot;:1,&quot;approval_status&quot;:1,&quot;refuse_reason&quot;:&quot;&quot;,&quot;keyword&quot;:&quot;苹果手机&quot;,&quot;create_time&quot;:1651099423000,&quot;update_time&quot;:1651099423000,&quot;option_status&quot;:1}],&quot;database&quot;:&quot;canal_test&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1651128223000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[&quot;id&quot;],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;gms_spu&quot;,&quot;ts&quot;:1651128233733,&quot;type&quot;:&quot;INSERT&quot;}
Affected indexes: gms_spu</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">es索引结果  GET gms_spu/_doc/11</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>_index</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">gms_spu</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>_type</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">_doc</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>_id</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">18</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>_version</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">1</span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>_seq_no</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">2</span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>_primary_term</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">1</span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>found</span><span style="color:#404">&quot;</span></span> : <span style="color:#088">true</span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>_source</span><span style="color:#404">&quot;</span></span> : {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>catalog_id</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">4</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>spu_sn</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">huawei-02</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">苹果手机</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>sub_title</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Apple iPhone 13 (A2634)128GB 绿色 支持移动联通电信5G 双卡双待手机</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>introduce</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">超明亮,超绚丽,超锐丽</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>image</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://img11.360buyimg.com/n1/s450x450_jfs/t1/213049/40/14248/57026/6227c9baEdf8e6336/5594ed4d66ef9647.jpg</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>price</span><span style="color:#404">&quot;</span></span> : <span style="color:#60E">5999.0</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>market_price</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">5999</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>total_sales</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">6000000</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>total_score</span><span style="color:#404">&quot;</span></span> : <span style="color:#60E">98.7</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>total_comment</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">10000</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>priority</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">99</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>spu_images</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>virtual_stock</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">6000</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>enable_integral</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">1000</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>spu_status</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">1</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>approval_status</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">1</span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>refuse_reason</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>keyword</span><span style="color:#404">&quot;</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">苹果手机</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>option_status</span><span style="color:#404">&quot;</span></span> : <span style="color:#00D">1</span>
  }
}</code></pre>
</div>
</div>
<details>
<summary class="title"><a href="http://10.207.0.169:5601/app/kibana#/dev_tools/console" class="bare">http://10.207.0.169:5601/app/kibana#/dev_tools/console</a></summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/canal/es_index.png" alt="es_index">
</div>
</div>
</div>
</details>
<div class="listingblock">
<div class="title">问题</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">java.lang.RuntimeException: java.lang.IllegalArgumentException: cannot write xcontent for unknown value of type class java.sql.Timestamp
        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:116) ~[na:na]
        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:64) ~[na:na]
        at com.alibaba.otter.canal.client.adapter.es.core.ESAdapter.sync(ESAdapter.java:115) ~[na:na]
        at com.alibaba.otter.canal.client.adapter.es.core.ESAdapter.sync(ESAdapter.java:94) ~[na:na]
        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.batchSync(AdapterProcessor.java:139) ~[client-adapter.launcher-1.1.5.ja
r:na]
        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.lambda$null$1(AdapterProcessor.java:97) ~[client-adapter.launcher-1.1.5
.jar:na]
        at java.util.concurrent.CopyOnWriteArrayList.forEach(CopyOnWriteArrayList.java:895) ~[na:1.8.0_322]
        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.lambda$null$2(AdapterProcessor.java:94) ~[client-adapter.launcher-1.1.5
.jar:na]
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_322]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[na:1.8.0_322]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[na:1.8.0_322]
        at java.lang.Thread.run(Thread.java:750) ~[na:1.8.0_322]
Caused by: java.lang.IllegalArgumentException: cannot write xcontent for unknown value of type class java.sql.Timestamp</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
es7不支持日期时间戳转换导致的,可以通过sql把日期转换成字符串同步
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="canalend">End</h2>
<div class="sectionbody">
<hr>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-04-28 15:21:26 +0800
</div>
</div>
</body>
</html>